---
import Layout from "../../layouts/Layout.astro";
import { getPageTranslations, isSupportedLanguage } from "../../utils/i18n";
import BookingForm from "../../components/BookingForm.tsx";
import { getAvailableTime } from "../../services/calendly";

export const prerender = false;

const { lang } = Astro.params;

if (!lang || !isSupportedLanguage(lang)) {
    return Astro.redirect("/404");
}

const translations = getPageTranslations(lang, "book");

const availableTimes = await getAvailableTime();
const camelCaseTimes = availableTimes.map((time) => ({
    inviteesRemaining: time.invitees_remaining,
    schedulingUrl: time.scheduling_url,
    startTime: time.start_time,
    status: time.status,
}));
---

<Layout>
    <BookingForm
        translations={translations}
        initialAvailability={camelCaseTimes}
        lang={lang}
        client:load
    />
</Layout>
